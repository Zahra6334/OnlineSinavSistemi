@model OnlineSinavSistemi.Models.StudentExam
@{
    ViewData["Title"] = "Sýnavý Çöz";
    var exam = Model?.Exam;
    var totalQuestions = exam?.Questions?.Count ?? 0;
}

<style>
    :root {
        --primary-color: #2c5aa0;
        --secondary-color: #e9f2f9;
        --accent-color: #d4af37;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #e74c3c;
        --text-dark: #333;
        --text-light: #555;
        --white: #ffffff;
        --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
    }

    .take-exam-section {
        background: linear-gradient(135deg, #f8fafc 0%, #e9f2f9 100%);
        min-height: 100vh;
        padding: 40px 0;
    }

    .exam-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #1a3a6d 100%);
        color: var(--white);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
    }

        .exam-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" preserveAspectRatio="none"><path d="M0,0 Q500,100 1000,0 L1000,100 L0,100 Z" fill="rgba(255,255,255,0.05)"/></svg>');
            background-size: 100% 100px;
            background-position: bottom;
        }

    .exam-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .exam-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 25px;
        margin-top: 20px;
        position: relative;
        z-index: 1;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.15);
        padding: 10px 20px;
        border-radius: 50px;
    }

    .meta-icon {
        font-size: 1.2rem;
    }

    .meta-content {
        display: flex;
        flex-direction: column;
    }

    .meta-label {
        font-size: 0.85rem;
        opacity: 0.9;
    }

    .meta-value {
        font-weight: 600;
        font-size: 1.1rem;
    }

    .timer-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: var(--white);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        padding: 20px;
        text-align: center;
        min-width: 150px;
        border: 3px solid transparent;
        transition: var(--transition);
    }

        .timer-container.warning {
            border-color: var(--warning-color);
            animation: pulse 2s infinite;
        }

        .timer-container.danger {
            border-color: var(--danger-color);
            animation: pulse 1s infinite;
        }

    .timer-label {
        color: var(--text-light);
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 0.9rem;
    }

    .timer-display {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary-color);
        font-family: 'Courier New', monospace;
    }

    .exam-container {
        background: var(--white);
        border-radius: 20px;
        box-shadow: var(--shadow);
        padding: 40px;
        margin-bottom: 30px;
        position: relative;
    }

    .question-nav {
        position: sticky;
        top: 20px;
        margin-bottom: 40px;
        background: var(--secondary-color);
        border-radius: 15px;
        padding: 20px;
        z-index: 100;
    }

    .question-nav-title {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 15px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .question-numbers {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .question-number-btn {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        border: 2px solid #e1e8f0;
        background: var(--white);
        color: var(--text-dark);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .question-number-btn:hover {
            transform: translateY(-3px);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .question-number-btn.active {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .question-number-btn.answered {
            background: var(--success-color);
            color: var(--white);
            border-color: var(--success-color);
        }

    .question-card {
        background: var(--white);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        border: 2px solid #e1e8f0;
        transition: var(--transition);
        position: relative;
    }

        .question-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(44, 90, 160, 0.1);
        }

        .question-card.active {
            border-color: var(--primary-color);
            background: rgba(44, 90, 160, 0.02);
        }

    .question-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--secondary-color);
    }

    .question-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 10px;
        line-height: 1.4;
    }

    .question-meta {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .question-type-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .type-multiple {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(40, 167, 69, 0.2);
    }

    .type-classic {
        background: rgba(23, 162, 184, 0.1);
        color: var(--info-color);
        border: 1px solid rgba(23, 162, 184, 0.2);
    }

    .question-point {
        background: rgba(212, 175, 55, 0.1);
        color: var(--accent-color);
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .question-body {
        margin-top: 20px;
    }

    .choices-container {
        margin-top: 20px;
    }

    .choice-item {
        margin-bottom: 15px;
        transition: var(--transition);
    }

    .choice-input {
        display: none;
    }

    .choice-label {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        padding: 20px;
        border-radius: 15px;
        border: 2px solid #e1e8f0;
        background: var(--white);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
    }

        .choice-label:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            background: rgba(44, 90, 160, 0.02);
        }

    .choice-input:checked + .choice-label {
        border-color: var(--primary-color);
        background: rgba(44, 90, 160, 0.05);
        box-shadow: 0 5px 15px rgba(44, 90, 160, 0.1);
    }

    .choice-letter {
        width: 40px;
        height: 40px;
        background: var(--secondary-color);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: var(--primary-color);
        font-size: 1.1rem;
        flex-shrink: 0;
        transition: var(--transition);
    }

    .choice-input:checked + .choice-label .choice-letter {
        background: var(--primary-color);
        color: var(--white);
    }

    .choice-text {
        flex: 1;
        color: var(--text-dark);
        line-height: 1.6;
        font-size: 1.1rem;
        padding-top: 3px;
    }

    .classic-answer-container {
        margin-top: 25px;
    }

    .answer-textarea {
        width: 100%;
        min-height: 150px;
        padding: 20px;
        border: 2px solid #e1e8f0;
        border-radius: 15px;
        font-size: 1rem;
        line-height: 1.6;
        transition: var(--transition);
        resize: vertical;
        background: var(--white);
    }

        .answer-textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

    .file-upload-container {
        margin-top: 25px;
    }

    .file-upload-label {
        display: block;
        margin-bottom: 10px;
        color: var(--primary-color);
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .file-upload-box {
        border: 2px dashed #c0d4e8;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
        background: var(--secondary-color);
    }

        .file-upload-box:hover {
            border-color: var(--primary-color);
            background: rgba(44, 90, 160, 0.05);
        }

        .file-upload-box.dragover {
            border-color: var(--success-color);
            background: rgba(40, 167, 69, 0.05);
        }

    .file-upload-icon {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 15px;
    }

    .file-upload-text {
        color: var(--text-light);
        margin-bottom: 10px;
    }

    .file-upload-input {
        display: none;
    }

    .file-upload-btn {
        display: inline-block;
        background: var(--primary-color);
        color: var(--white);
        padding: 12px 25px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

        .file-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 90, 160, 0.2);
        }

    .selected-file {
        margin-top: 15px;
        padding: 15px;
        background: rgba(40, 167, 69, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(40, 167, 69, 0.2);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .file-icon {
        color: var(--success-color);
        font-size: 1.5rem;
    }

    .file-name {
        font-weight: 600;
        color: var(--text-dark);
    }

    .file-size {
        color: var(--text-light);
        font-size: 0.9rem;
    }

    .remove-file {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
        border: none;
        padding: 5px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: var(--transition);
    }

        .remove-file:hover {
            background: var(--danger-color);
            color: var(--white);
        }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid var(--secondary-color);
    }

    .btn-prev, .btn-next, .btn-submit {
        padding: 16px 35px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        border: none;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
    }

    .btn-prev {
        background: transparent;
        color: var(--text-light);
        border: 2px solid #e1e8f0;
    }

        .btn-prev:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

    .btn-next {
        background: linear-gradient(135deg, var(--primary-color) 0%, #1a3a6d 100%);
        color: white;
    }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(44, 90, 160, 0.3);
        }

    .btn-submit {
        background: linear-gradient(135deg, var(--success-color) 0%, #1e7e34 100%);
        color: white;
    }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

    .progress-indicator {
        margin-bottom: 30px;
    }

    .progress-bar {
        height: 8px;
        background: var(--secondary-color);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .progress-text {
        display: flex;
        justify-content: space-between;
        color: var(--text-light);
        font-size: 0.9rem;
    }

    @@media (max-width: 768px) {
        .timer-container

    {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 20px;
        width: 100%;
    }

    .exam-container {
        padding: 20px;
    }

    .question-nav {
        position: relative;
        top: auto;
    }

    .question-numbers {
        justify-content: center;
    }

    .question-number-btn {
        width: 40px;
        height: 40px;
    }

    .exam-header {
        padding: 20px;
    }

    .exam-title {
        font-size: 1.8rem;
    }

    .exam-meta {
        gap: 10px;
    }

    .meta-item {
        flex: 1;
        min-width: calc(50% - 10px);
    }

    .navigation-buttons {
        flex-direction: column;
        gap: 15px;
    }

    .btn-prev, .btn-next, .btn-submit {
        width: 100%;
        justify-content: center;
    }

    }

    @@keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4);
        }

        70% {
            box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
        }
    }

    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: var(--white);
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        text-align: center;
    }

    .modal-icon {
        font-size: 4rem;
        color: var(--warning-color);
        margin-bottom: 20px;
    }

    .modal-title {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 1.8rem;
        margin-bottom: 15px;
    }

    .modal-text {
        color: var(--text-light);
        line-height: 1.6;
        margin-bottom: 25px;
    }

    .modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .modal-btn {
        padding: 12px 30px;
        border-radius: 50px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        min-width: 120px;
    }

    .modal-btn-cancel {
        background: transparent;
        color: var(--text-light);
        border: 2px solid #e1e8f0;
    }

        .modal-btn-cancel:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

    .modal-btn-confirm {
        background: linear-gradient(135deg, var(--success-color) 0%, #1e7e34 100%);
        color: white;
    }

        .modal-btn-confirm:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
</style>

<div class="take-exam-section">
    <!-- Timer -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-label">KALAN SÜRE</div>
        <div class="timer-display" id="timerDisplay">@(exam?.DurationMinutes ?? 40):00</div>
    </div>

    <div class="container">
        <!-- Exam Header -->
        <div class="exam-header">
            <h1 class="exam-title">@exam?.Title</h1>
            <div class="exam-meta">
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="meta-content">
                        <span class="meta-label">DERS</span>
                        <span class="meta-value">@exam?.Course?.CourseName</span>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="meta-content">
                        <span class="meta-label">TOPLAM SÜRE</span>
                        <span class="meta-value">@exam?.DurationMinutes dakika</span>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="meta-content">
                        <span class="meta-label">SORU SAYISI</span>
                        <span class="meta-value">@totalQuestions soru</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-text">
                <span>Ýlerleme: <span id="currentQuestion">1</span>/@totalQuestions</span>
                <span id="answeredCount">0 cevaplandý</span>
            </div>
        </div>

        <!-- Question Navigation -->
        <div class="question-nav">
            <div class="question-nav-title">
                <i class="fas fa-map"></i> Soru Navigasyonu
            </div>
            <div class="question-numbers" id="questionNumbers">
                @for (int i = 0; i < totalQuestions; i++)
                {
                    <button type="button" class="question-number-btn" data-question-index="@i">
                        @(i + 1)
                    </button>
                }
            </div>
        </div>

        <!-- Exam Form -->
        <form asp-action="SubmitExam" method="post" enctype="multipart/form-data" id="examForm">
            <input type="hidden" asp-for="Id" />

            <div class="exam-container">
                @if (exam?.Questions != null && exam.Questions.Any())
                {
                    @for (int i = 0; i < exam.Questions.Count; i++)
                    {
                        var question = exam.Questions.ElementAt(i);
                        var questionType = question.Type == OnlineSinavSistemi.Models.QuestionType.CoktanSecmeli ? "multiple" : "classic";

                        <div class="question-card @(i == 0 ? "active" : "")" id="question-@i" data-question-index="@i">
                            <div class="question-header">
                                <h3 class="question-title">
                                    <span class="question-number">@(i + 1).</span>
                                    @question.QuestionText
                                </h3>
                                <div class="question-meta">
                                    <span class="question-type-badge @(questionType == "multiple" ? "type-multiple" : "type-classic")">
                                        <i class="fas @(questionType == "multiple" ? "fa-list-ol" : "fa-keyboard")"></i>
                                        @(questionType == "multiple" ? "Çoktan Seçmeli" : "Klasik")
                                    </span>
                                    <span class="question-point">
                                        <i class="fas fa-star"></i>
                                        @question.Point puan
                                    </span>
                                </div>
                            </div>

                            <input type="hidden" name="Answers[@i].QuestionId" value="@question.Id" />

                            <div class="question-body">
                                @if (question.Type == OnlineSinavSistemi.Models.QuestionType.CoktanSecmeli)
                                {
                                    <div class="choices-container">
                                        @{
                                            var choiceLetters = new string[] { "A", "B", "C", "D" };
                                            int choiceIndex = 0;
                                        }

                                        @foreach (var choice in question.Choices ?? new List<OnlineSinavSistemi.Models.Choice>())
                                        {
                                            <div class="choice-item">
                                                <input class="choice-input"
                                                       type="radio"
                                                       name="Answers[@i].SelectedChoiceId"
                                                       id="choice-@choice.Id-@i"
                                                       value="@choice.Id"
                                                       data-question-index="@i" />
                                                <label class="choice-label" for="choice-@choice.Id-@i">
                                                    <span class="choice-letter">@choiceLetters[choiceIndex]</span>
                                                    <span class="choice-text">@choice.Text</span>
                                                </label>
                                            </div>
                                            choiceIndex++;
                                        }
                                    </div>
                                }
                                else if (question.Type == OnlineSinavSistemi.Models.QuestionType.Klasik)
                                {
                                    <div class="classic-answer-container">
                                        <div class="answer-textarea-container">
                                            <textarea class="answer-textarea"
                                          name="Answers[@i].AnswerText"
                                          rows="6"
                                          placeholder="Sorunuzun cevabýný buraya yazýn..."
                                          data-question-index="@i"></textarea>
                                        </div>

                                        <div class="file-upload-container">
                                            <label class="file-upload-label">
                                                <i class="fas fa-file-upload"></i> Dosya Yükle (PDF, DOCX, JPG, PNG)
                                            </label>
                                            <div class="file-upload-box" id="fileDropArea-@i">
                                                <div class="file-upload-icon">
                                                    <i class="fas fa-cloud-upload-alt"></i>
                                                </div>
                                                <div class="file-upload-text">
                                                    Dosyayý sürükleyip býrakýn veya seçmek için týklayýn
                                                </div>
                                                <input type="file"
                                                       class="file-upload-input"
                                                       id="fileInput-@i"
                                                       name="Answers[@i].FileUpload"
                                                       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt"
                                                       data-question-index="@i">
                                                <label for="fileInput-@i" class="file-upload-btn">
                                                    Dosya Seç
                                                </label>
                                            </div>
                                            <div class="selected-file" id="selectedFile-@i" style="display: none;">
                                                <div class="file-info">
                                                    <i class="fas fa-file-alt file-icon"></i>
                                                    <div>
                                                        <div class="file-name" id="fileName-@i"></div>
                                                        <div class="file-size" id="fileSize-@i"></div>
                                                    </div>
                                                </div>
                                                <button type="button" class="remove-file" onclick="removeFile(@i)">
                                                    <i class="fas fa-times"></i> Kaldýr
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }

                    <!-- Navigation Buttons -->
                    <div class="navigation-buttons">
                        <button type="button" class="btn-prev" id="prevBtn" style="display: none;">
                            <i class="fas fa-arrow-left"></i>
                            <span>Önceki Soru</span>
                        </button>

                        <button type="button" class="btn-next" id="nextBtn" @(totalQuestions == 1 ? "style='display: none;'" : "")>
                            <span>Sonraki Soru</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>

                        <button type="button" class="btn-submit" id="submitBtn" @(totalQuestions > 1 ? "style='display: none;'" : "")>
                            <i class="fas fa-paper-plane"></i>
                            <span>Sýnavý Bitir</span>
                        </button>
                    </div>
                }
                else
                {
                    <div class="empty-state" style="text-align: center; padding: 60px 20px;">
                        <div class="empty-state-icon" style="font-size: 3rem; color: #c0d4e8;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3>Henüz Soru Yok</h3>
                        <p>Bu sýnavda henüz soru bulunmamaktadýr.</p>
                    </div>
                }
            </div>
        </form>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmationModal">
    <div class="modal-content">
        <div class="modal-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="modal-title">Sýnavý Bitir</h3>
        <p class="modal-text">
            Sýnavý bitirmek üzeresiniz. Bu iþlem geri alýnamaz. Bitirmeden önce tüm sorularý kontrol etmeniz önerilir.
        </p>
        <div class="modal-buttons">
            <button type="button" class="modal-btn modal-btn-cancel" id="cancelSubmit">
                Ýptal
            </button>
            <button type="button" class="modal-btn modal-btn-confirm" id="confirmSubmit">
                Sýnavý Bitir
            </button>
        </div>
    </div>
</div>

<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Variables
        const totalQuestions = @totalQuestions;
        let currentQuestionIndex = 0;
        let answeredQuestions = new Set();
        let timeRemaining = @(exam?.DurationMinutes ?? 40) * 60; // Convert to seconds
        let timerInterval;

        // DOM Elements
        const timerContainer = document.getElementById('timerContainer');
        const timerDisplay = document.getElementById('timerDisplay');
        const progressFill = document.getElementById('progressFill');
        const currentQuestionSpan = document.getElementById('currentQuestion');
        const answeredCountSpan = document.getElementById('answeredCount');
        const questionNumbers = document.querySelectorAll('.question-number-btn');
        const questionCards = document.querySelectorAll('.question-card');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const examForm = document.getElementById('examForm');
        const confirmationModal = document.getElementById('confirmationModal');
        const cancelSubmitBtn = document.getElementById('cancelSubmit');
        const confirmSubmitBtn = document.getElementById('confirmSubmit');

        // File upload elements
        const fileInputs = document.querySelectorAll('.file-upload-input');
        const fileDropAreas = document.querySelectorAll('.file-upload-box');

        // Initialize timer
        updateTimerDisplay();
        startTimer();

        // Initialize progress
        updateProgress();

        // Update answered count
        updateAnsweredCount();

        // Question Navigation
        function showQuestion(index) {
            // Hide all questions
            questionCards.forEach(card => {
                card.classList.remove('active');
            });

            // Show selected question
            const questionCard = document.getElementById(`question-${index}`);
            if (questionCard) {
                questionCard.classList.add('active');
            }

            // Update navigation buttons
            questionNumbers.forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.questionIndex) === index) {
                    btn.classList.add('active');
                }
            });

            // Update current question indicator
            currentQuestionIndex = index;
            currentQuestionSpan.textContent = index + 1;

            // Show/hide navigation buttons
            prevBtn.style.display = index === 0 ? 'none' : 'inline-flex';
            nextBtn.style.display = index === totalQuestions - 1 ? 'none' : 'inline-flex';
            submitBtn.style.display = index === totalQuestions - 1 ? 'inline-flex' : 'none';
        }

        // Question number buttons
        questionNumbers.forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.dataset.questionIndex);
                showQuestion(index);
            });
        });

        // Navigation buttons
        prevBtn.addEventListener('click', function() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        });

        nextBtn.addEventListener('click', function() {
            if (currentQuestionIndex < totalQuestions - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        });

        // Submit button
        submitBtn.addEventListener('click', function() {
            // Check if all questions are answered
            if (answeredQuestions.size < totalQuestions) {
                Swal.fire({
                    title: 'Eksik Cevaplar',
                    html: `
                        <div style="text-align: left; padding: 15px;">
                            <p>Toplam <strong>${totalQuestions}</strong> sorudan <strong>${answeredQuestions.size}</strong> tanesini cevapladýnýz.</p>
                            <p>${totalQuestions - answeredQuestions.size} soru henüz cevaplanmadý.</p>
                            <p>Yine de sýnavý bitirmek istiyor musunuz?</p>
                        </div>
                    `,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#e74c3c',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Evet, Bitir',
                    cancelButtonText: 'Cevaplamaya Devam Et'
                }).then((result) => {
                    if (result.isConfirmed) {
                        confirmationModal.style.display = 'flex';
                    }
                });
            } else {
                confirmationModal.style.display = 'flex';
            }
        });

        // Modal buttons
        cancelSubmitBtn.addEventListener('click', function() {
            confirmationModal.style.display = 'none';
        });

        confirmSubmitBtn.addEventListener('click', function() {
            stopTimer();
            examForm.submit();
        });

        // Track answered questions
        function trackAnsweredQuestion(index) {
            answeredQuestions.add(index);
            updateAnsweredCount();
            updateQuestionNumberStatus(index);
            updateProgress();
        }

        // Multiple choice selection
        const choiceInputs = document.querySelectorAll('.choice-input');
        choiceInputs.forEach(input => {
            input.addEventListener('change', function() {
                const questionIndex = parseInt(this.dataset.questionIndex);
                trackAnsweredQuestion(questionIndex);
            });

            // Check if already selected on page load
            if (input.checked) {
                const questionIndex = parseInt(input.dataset.questionIndex);
                trackAnsweredQuestion(questionIndex);
            }
        });

        // Classic answer tracking
        const answerTextareas = document.querySelectorAll('.answer-textarea');
        answerTextareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                const questionIndex = parseInt(this.dataset.questionIndex);
                if (this.value.trim() !== '') {
                    trackAnsweredQuestion(questionIndex);
                } else {
                    answeredQuestions.delete(questionIndex);
                    updateAnsweredCount();
                    updateQuestionNumberStatus(questionIndex);
                    updateProgress();
                }
            });

            // Check if already filled on page load
            if (textarea.value.trim() !== '') {
                const questionIndex = parseInt(textarea.dataset.questionIndex);
                trackAnsweredQuestion(questionIndex);
            }
        });

        // File upload handling
        fileInputs.forEach((input, index) => {
            const fileDropArea = document.getElementById(`fileDropArea-${index}`);
            const selectedFileDiv = document.getElementById(`selectedFile-${index}`);
            const fileNameSpan = document.getElementById(`fileName-${index}`);
            const fileSizeSpan = document.getElementById(`fileSize-${index}`);

            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                fileDropArea.classList.add('dragover');
            }

            function unhighlight() {
                fileDropArea.classList.remove('dragover');
            }

            // Handle drop
            fileDropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files, index);
            }

            // Handle click
            fileDropArea.addEventListener('click', function() {
                input.click();
            });

            // Handle file selection
            input.addEventListener('change', function() {
                handleFiles(this.files, index);
            });
        });

        function handleFiles(files, questionIndex) {
            if (files.length > 0) {
                const file = files[0];
                const selectedFileDiv = document.getElementById(`selectedFile-${questionIndex}`);
                const fileNameSpan = document.getElementById(`fileName-${questionIndex}`);
                const fileSizeSpan = document.getElementById(`fileSize-${questionIndex}`);

                // Display file info
                fileNameSpan.textContent = file.name;
                fileSizeSpan.textContent = formatFileSize(file.size);
                selectedFileDiv.style.display = 'flex';

                // Track as answered
                trackAnsweredQuestion(questionIndex);
            }
        }

        function removeFile(questionIndex) {
            const input = document.getElementById(`fileInput-${questionIndex}`);
            const selectedFileDiv = document.getElementById(`selectedFile-${questionIndex}`);

            // Clear file input
            input.value = '';
            selectedFileDiv.style.display = 'none';

            // Check if question still has text answer
            const textarea = document.querySelector(`textarea[data-question-index="${questionIndex}"]`);
            if (!textarea || textarea.value.trim() === '') {
                answeredQuestions.delete(questionIndex);
                updateAnsweredCount();
                updateQuestionNumberStatus(questionIndex);
                updateProgress();
            }
        }

        window.removeFile = removeFile;

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Timer functions
        function startTimer() {
            timerInterval = setInterval(function() {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    stopTimer();
                    Swal.fire({
                        title: 'Süre Doldu!',
                        text: 'Sýnav süreniz doldu. Cevaplarýnýz otomatik olarak gönderilecek.',
                        icon: 'warning',
                        confirmButtonColor: '#e74c3c',
                        confirmButtonText: 'Tamam'
                    }).then(() => {
                        examForm.submit();
                    });
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // Update timer appearance based on remaining time
            timerContainer.classList.remove('warning', 'danger');
            if (timeRemaining <= 300) { // 5 minutes or less
                timerContainer.classList.add('danger');
            } else if (timeRemaining <= 600) { // 10 minutes or less
                timerContainer.classList.add('warning');
            }
        }

        // Update progress
        function updateProgress() {
            const progress = totalQuestions > 0 ? (answeredQuestions.size / totalQuestions) * 100 : 0;
            progressFill.style.width = `${progress}%`;
        }

        // Update answered count
        function updateAnsweredCount() {
            answeredCountSpan.textContent = `${answeredQuestions.size} cevaplandý`;
        }

        // Update question number status
        function updateQuestionNumberStatus(index) {
            const btn = document.querySelector(`.question-number-btn[data-question-index="${index}"]`);
            if (btn) {
                btn.classList.remove('answered');
                if (answeredQuestions.has(index)) {
                    btn.classList.add('answered');
                }
            }
        }

        // Warn before leaving page
        window.addEventListener('beforeunload', function(e) {
            if (timeRemaining > 0) {
                e.preventDefault();
                e.returnValue = 'Sýnav devam ediyor. Sayfadan ayrýlmak istediðinize emin misiniz?';
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentQuestionIndex > 0) {
                e.preventDefault();
                showQuestion(currentQuestionIndex - 1);
            } else if (e.key === 'ArrowRight' && currentQuestionIndex < totalQuestions - 1) {
                e.preventDefault();
                showQuestion(currentQuestionIndex + 1);
            }
        });

        // Initialize first question
        showQuestion(0);
    });
</script>

<!-- SweetAlert2 için CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>