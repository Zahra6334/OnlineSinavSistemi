@model OnlineSinavSistemi.Models.Exam

@{
    ViewData["Title"] = "Yeni Sýnav Oluþtur";
}

<div class="container mt-4">
    <h2>@ViewData["Title"]</h2>

    <form asp-action="Create" method="post">
        <div class="mb-3">
            <label asp-for="Baslik" class="form-label">Sýnav Adý</label>
            <input asp-for="Baslik" class="form-control" />
            <span asp-validation-for="Baslik" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="CourseId" class="form-label">Ders Seçin</label>
            <select asp-for="CourseId" class="form-select" asp-items="ViewBag.Dersler">
                <option value="">-- Ders Seçin --</option>
                 <option value="2">Türkçe</option> 
                 <option value="3">Fizik</option> 
                 <option value="4">Kimya</option> 
                 <option value="5">Biyoloji</option> 
                 <option value="6">Tarih</option>
                 <option value="7">Coðrafya</option> 
                 <option value="8">Ýngilizce</option> 
                 <option value="9">Felsefe</option>
                 <option value="11">Din Kültürü ve Ahlak Bilgisi</option> 
                 <option value="12">Müzik</option> 
                 <option value="13">Görsel Sanatlar</option> </select>
            </select>
            <span asp-validation-for="CourseId" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="BaslangicTarihi" class="form-label">Sýnav Baþlangýç Tarihi</label>
            <input asp-for="BaslangicTarihi" type="datetime-local" class="form-control" />
            <span asp-validation-for="BaslangicTarihi" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="SureDakika" class="form-label">Süre (Dakika)</label>
            <input asp-for="SureDakika" type="number" class="form-control" />
            <span asp-validation-for="SureDakika" class="text-danger"></span>
        </div>

        <hr />
        <h4>Sorular</h4>
        <div id="questionsContainer"></div>
        <button type="button" class="btn btn-info mb-3" onclick="addQuestion()">Soru Ekle</button>

        <button type="submit" class="btn btn-success">Sýnavý Oluþtur</button>
        <a asp-action="Index" class="btn btn-secondary">Geri</a>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        let questionIndex = 0;

        function addQuestion() {
            const container = document.getElementById('questionsContainer');
            const div = document.createElement('div');
            div.classList.add('card', 'mb-3', 'p-3');

            div.innerHTML = `
                <div class="mb-2">
                    <label>Soru Metni</label>
                    <input name="Questions[${questionIndex}].SoruMetni" class="form-control" />
                </div>
                <div class="mb-2">
                    <label>Soru Tipi</label>
                    <select name="Questions[${questionIndex}].Tip" class="form-select">
                        <option value="0">Çoktan Seçmeli</option>
                        <option value="1">Klasik</option>
                    </select>
                </div>
                <div class="mb-2 choicesContainer" style="display:none;">
                    <label>Seçenekler (Çoktan Seçmeli)</label>
                    <input name="Questions[${questionIndex}].Choices[0].Text" class="form-control mb-1" placeholder="Seçenek 1" />
                    <input name="Questions[${questionIndex}].Choices[1].Text" class="form-control mb-1" placeholder="Seçenek 2" />
                    <input name="Questions[${questionIndex}].Choices[2].Text" class="form-control mb-1" placeholder="Seçenek 3" />
                    <input name="Questions[${questionIndex}].Choices[3].Text" class="form-control mb-1" placeholder="Seçenek 4" />
                </div>
                <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Soru Sil</button>
                <hr/>
            `;

            container.appendChild(div);

            // Soru tipi deðiþtiðinde seçenekleri göster/gizle
            const tipSelect = div.querySelector('select');
            const choicesDiv = div.querySelector('.choicesContainer');
            tipSelect.addEventListener('change', () => {
                choicesDiv.style.display = tipSelect.value == "0" ? "block" : "none";
            });

            questionIndex++;
        }
    </script>
}
